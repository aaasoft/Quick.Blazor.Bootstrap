@using System.IO
@using Tewr.Blazor.FileReader

@inject IFileReaderService fileReaderService;

<div class="row">
    <div class="col-12 p-0">
        @if (!string.IsNullOrEmpty(CurrentPath))
        {
            <div class="btn-toolbar mb-1">
                <div class="btn-group mr-2">
                    <button title="@TextUp" type="button" class="btn btn-info" @onclick="btnGotoUpper_Click">
                        @IconUp
                    </button>
                </div>
                <div class="btn-group mr-2">
                    <button title="@TextNewFolder" type="button" class="btn btn-info" @onclick="btnCreateFolder_Click">
                        @IconNewFolder
                    </button>
                    <div class="btn btn-info">
                        @IconUpload
                        <input @ref="inputFile" id="inputFile" type="file" style="width: 0px; visibility: collapse;" @onchange="onInputFileChanged">
                        <label title="@TextUpload" style="position: absolute;top: 0;left: 0;right:0;margin:0;height:100%;cursor:pointer" for="inputFile">
                        </label>
                    </div>
                </div>
                <div class="btn-group mr-2">
                    <button title="@TextRefresh" type="button" class="btn btn-info" @onclick="refresh">
                        @IconRefresh
                    </button>
                    @if (SelectedItem != null && SelectedItem is FileInfo)
                    {
                        <button title="@TextDownload" type="button" class="btn btn-info" @onclick="btnDownload_Click">
                            @IconDownload
                        </button>
                    }
                    @if (SelectedItem != null)
                    {
                        <button title="@TextRename" type="button" class="btn btn-info" @onclick="btnRename_Click">
                            @IconRename
                        </button>
                        <button title="@TextDelete" type="button" class="btn btn-info" @onclick="btnDelete_Click">
                            @IconDelete
                        </button>
                    }
                </div>
            </div>
        }
        <div class="input-group">
            <div class="input-group-prepend">
                <span class="input-group-text">@TextPath</span>
            </div>
            <input type="text" class="form-control col-auto" @bind-value="CurrentPath" />
            <div class="input-group-append">
                <button title="@TextGoto" type="button" class="btn btn-info" @onclick="btnGoto_Click">
                    @IconGoto
                </button>
            </div>
        </div>
    </div>
    <div class="card col-12 p-0 mt-2">
        <div class="card-body">
            <div class="row">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th scope="col">@TextName</th>
                            <th scope="col">@TextLastWriteTime</th>
                            <th scope="col">@TextSize</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Dirs != null)
                        {
                            @foreach (var dir in Dirs)
                            {
                                <tr class="@(SelectedItem == dir ? "table-active" : "")" @onclick="@(e => SelectedItem = dir)" @ondblclick="@(e => gotoDir(dir))">
                                    <td>@IconFolder@dir.Name</td>
                                    <td>@dir.LastWriteTime</td>
                                    <td></td>
                                </tr>
                            }
                        }
                        @if (Files != null)
                        {
                            @foreach (var file in Files)
                            {
                                <tr class="@(SelectedItem == file ? "table-active" : "")" @onclick="@(e => SelectedItem = file)" @ondblclick="btnDownload_Click">
                                    <td>@IconFile@file.Name</td>
                                    <td>@file.LastWriteTime</td>
                                    <td>@(storageUSC.GetString(file.Length, 0, true))B</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<ModalLoading @ref="loading" />
<ModalAlert @ref="alert" />
<ModalPrompt @ref="prompt" />
